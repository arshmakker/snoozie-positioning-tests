<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snoozie â€“ Night Companion</title>
  <link rel="stylesheet" href="../shared/base.css">
  <link rel="stylesheet" href="style.css">
  <!-- Privacy-friendly analytics by Plausible -->
  <script
    defer
    data-domain="arshmakker.github.io"
    src="https://plausible.io/js/script.js">
  </script>
</head>
<body>
  <div class="container">
    <div class="main-content">
      <p class="night-text">
        You're not alone here.<br><br>
        Stay for a bit.<br>
        There's nothing you need to do.
      </p>
      
      <audio id="night-audio" src="../assets/audio/snoozie-night-1.mp3" autoplay></audio>
      <p class="bridge-text">When you're ready, you can listen.</p>
      <button id="audio-control" class="audio-button">Pause</button>
      <p class="tap-hint" hidden>Tap play when you're ready.</p>
    </div>

    <div class="email-cta" hidden>
      <p class="cta-text">If this helped, would you like something like this tomorrow night too?</p>
      <form action="https://formspree.io/f/xnjanpba" method="POST" class="email-form">
        <input type="email" name="email" class="email-input" placeholder="your@email.com" required>
        <button type="submit" class="cta-button">Send me something gentle</button>
      </form>
      <p class="supporting-text">One email. No spam. Unsubscribe anytime.</p>
      <p class="thank-you-message" hidden>Thank you. I'll be here again.</p>
    </div>
  </div>

  <script>
    (function() {
      const audio = document.getElementById('night-audio');
      const control = document.getElementById('audio-control');
      const cta = document.querySelector('.email-cta');
      const form = document.querySelector('.email-form');
      const thankYou = document.querySelector('.thank-you-message');
      let ctaShown = false;

      audio.play().catch(() => {
        control.textContent = 'Begin listening';
        document.body.classList.add('needs-interaction');
        document.querySelector('.tap-hint').hidden = false;
      });
      audio.addEventListener('play', () => {
        control.textContent = 'Pause';
        document.querySelector('.tap-hint').hidden = true;
      });
      audio.addEventListener('pause', () => { control.textContent = 'Begin listening'; });

      control.addEventListener('click', () => {
        if (audio.paused) { audio.play(); } else { audio.pause(); }
      });

      const showCTA = () => {
        if (ctaShown) return;
        ctaShown = true;
        if (window.plausible) {
          plausible('NightExperienced', { props: { page: '/web-night' } });
        }
        cta.hidden = false;
      };

      audio.addEventListener('ended', showCTA);
      setTimeout(() => {
        if (audio.currentTime >= 90) showCTA();
      }, 180000);

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const res = await fetch(form.action, { method: form.method, body: new FormData(form), headers: { 'Accept': 'application/json' } });
        if (res.ok) { form.hidden = true; document.querySelector('.supporting-text').hidden = true; thankYou.hidden = false; }
      });
    })();
  </script>
</body>
</html>

